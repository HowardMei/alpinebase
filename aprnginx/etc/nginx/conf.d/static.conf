# Cache expire rules:
# This mirrors that of apache h5bp .htaccess file.
# However, nginx applies rules by location, the apache rules are defined by type.
# If you use no file extension in the url and serve html, with apache you get an
# expire time of 0s, with nginx you'd get an expire header of one month in the
# future (if the default expire rule is 1 month). Therefore, do not use a
# default expire rule with nginx unless your site is completely static

# Cache: Appcache, your document html and data
    location ~* \.(?:manifest|appcache|html?|xml|json)$ {
      expires       -1;
      access_log    /var/log/nginx/static.access.log;
    }

# Cache: Feed
    location ~* \.(?:rss|atom)$ {
      expires         1h;
      sendfile        on;
      tcp_nopush      on;
      tcp_nodelay     off;
      log_not_found   off;
      add_header      Cache-Control "public";
      access_log      /var/log/nginx/static.access.log main;
    }

# Cache: images, icons, video, audio, HTC
    location ~* \.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc)$ {
      expires       1M;
      sendfile        on;
      tcp_nopush      on;
      tcp_nodelay     off;
      log_not_found   off;
      add_header      Cache-Control "public";
      access_log      /var/log/nginx/static.access.log main;
    }

# Cache: CSS and Javascript
    location ~* \.(?:css|js)$ {
      expires       1y;
      sendfile        on;
      tcp_nopush      on;
      tcp_nodelay     off;
      log_not_found   off;
      add_header      Cache-Control "public";
    }

# Cache: Cross domain webfont access
    location ~* \.(?:ttf|ttc|otf|eot|woff|woff2)$ {
# For better security, you may selectively allow access based on [sub]domain:
      # add_header "Access-Control-Allow-Origin" "subdomain.example.com";
      # See http://wiki.nginx.org/HttpCoreModule#location
      # And https://github.com/h5bp/server-configs/issues/85
      # And https://github.com/h5bp/server-configs/issues/86
      expires       1M;
      sendfile        on;
      tcp_nopush      on;
      tcp_nodelay     off;
      log_not_found   off;
      add_header      Cache-Control "public";
    }

# Cache busting support:
# https://github.com/h5bp/html5-boilerplate/blob/5370479476dceae7cc3ea105946536d6bc0ee468/.htaccess#L403
# This will route all requests for /css/style.20120716.css to /css/style.css
# Read also this: github.com/h5bp/html5-boilerplate/wiki/cachebusting
    location ~* (.+)\.(?:\d+)\.(js|css|png|jpg|jpeg|gif)$ {
      try_files     $uri    $1.$2;
    }
