version: '2'
services:
  nginx:
    image: hwdm/aprnginx
    container_name: lemp_nginx
    restart: always
    volumes_from:
      - volume_appsrc
    ports:
      - 80:80
    environment:
      - _LISTEN_TO1=phpfpm:9000
      - _SERVER_MODE=phpfpm
      - _DOC_ROOT=/var/www/localhost/htdocs
    networks:
      - front
  phpfpm:
    image: hwdm/aprphpfpm
    container_name: lemp_php
    restart: always
    volumes_from:
      - volume_appsrc
    expose:
      - 9000
    environment:
      - _EXPOSE_TO=9000
    networks:
      - front
      - back
### Application Souce Code Container #####
  volume_appsrc:
    image: hwdm/apbase
    container_name: lemp_src
    volumes:
      - ./appsrc:/var/www/localhost/htdocs:rw

volumes:
  lemp-data:
    driver: local
  lemp-dbdata:
    driver: local
networks:
  front:
  back:
